### General Notes

> Also known as the `802.11` connection.

---
### Steps

> Communication is basically between an Access Point and a Client. [[Device Types]].

###### Discovery
1. Setting up the Access Point's SSID, or its name. [[Identifiers]].
2. The Access point then broadcasts a beacon frame every set time frame. This shows that the clients can connect to this available network with the given name.
	* This time interval can be set up in the advanced configuration.
3. The client sends a `probe request` with the same SSID to the access point.
4. The access point responds with a `probe response` with the same SSID to the client.

The client chooses the [[Security Standards]] from the ones available at the access point - a cipher. This can be WPA2, WPA, etc..

> All communication in this phase is unencrypted, also known as Open System Security.

###### Authentication

Here the handshake algorithm takes place between client and access point.
* This communication is encrypted.

###### Association

Client requests to associate with the network of the access point through a series of requests and responses.

---
### Authentication Handshake

##### Keys Generated and Used

There are many keys that are generated to encrypt the messages shared over the wireless connection.

1. PTK (Pairwise Transient Key): used to encrypt unicast traffic between client and access point. It is unique between client and access point.
PTK = PRF( PMK + ANonce + SNonce + MAC(AP) + MAC(C))
> The PRF is a randomizing function.

2. ANonce: A random number generated by access point.
3. SNonce: A random number generated by station.
4. MAC of client and access point. [[Data Link Layer#MAC Address]].
5. GTK (Group Temporal Key): used to encrypt all broadcast and multicast traffic between a single access point and all its connected stations. It is unique per access point.
6. PMK (Pairwise Master Key): Used in the PTK, and is created from the PSK. It is a long random key unique to the PSK and session.
7. PSK (Pre-Shared Key): Secret passphrase known to both client and access point. Password and SSID are used to create this key.
8. GMK (Group Master Key): Used to create the GTK on every access point.
9. MSK (Master Session Key): This is the first key generated while setting up the connection.

> The MSK is the first level key.
> The GMK and PMK are second level keys created from the MSK.
> The GTK and PTK are third level keys created from the second level keys and are the ones used for encryption.

PTK has other keys as well:
* KCK (Key Confirmation Key): used to create the MIC (Message Integrity Check).
* KEK (Key Encryption Key): used to encrypt data in communication.
* TK (Temporary Key): used to encrypt unicast packets.
##### Actual Handshake

1. Access point sends the first message to the client with its ANonce. Client can now create the PTK as it has all the information.
2. Client has PTK, it sends SNonce to the access point to create the PTK there too. This is sent with MIC (Message Integrity Check) for encryption.
3. The access point sends the GTK in message 3 to the client. Access point creates the GTK. Also has MIC.
4. Client sends final 4th message to access point to confirm that all keys are installed.

> Now any unicast traffic is encyrpted via the PTK, and all multicast traffic is encrypted via GTK.

---

