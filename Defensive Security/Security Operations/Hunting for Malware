### General Notes

This is a collection of strategies and identification techniques gathered from various sources.
- Useful in creating YARA rules.

---
### Techniques

Check if the first 2 bytes of the file are those of windows binaries.
- Can do this using `uint16(0) == 05a4d` in [[YARA]] rules.
- `05a4d` is `MZ` in ASCII, which is the magic number for windows executables.

Check the `imphash` of the malware.
- This is unique identifier for Windows executable files (PE files) based on the specific list and order of external libraries (DLLs) and functions they import, used mainly in malware analysis to find similar or related malicious software, even if slightly altered.
- For [[YARA]] rules, we can use the `pe.imphash()` function.

For `.NET` files, we need to do code reversing to be able to identify strings that we can place in YARA rules.
- This can be done us the `monodis` tool. Now, we get code that can be analyzed to identify patterns for this malware.
```bash
monodis --output=code Microsoft.Exchange.Service.exe
```
- Can also be done using `dnSpy` by loading the `.NET` assembly there.
- The magic number for `.NET` binaries is `BSJB`. It is present in the CLI header of `.NET` binaries.

This ensures the file is a legitimate PE format and not a corrupted or obfuscated one.
- `uint16(uint32(0x3c)) == 0x4550`: A two-step check. First, it reads a 32-bit (4 bytes) value from offset `0x3c` of the file. In PE files, this offset typically contains a pointer to the PE header. It then checks whether the two bytes at that pointer are `PE` (`0x4550`), indicating a valid PE header.

