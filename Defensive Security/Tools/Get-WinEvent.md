### General Notes

This is a PowerShell cmdlet that is used to query all types of [[Windows Events Log]]s.
- Has the power to retrieve different types of logs and logs generated by both [[Windows Events Log]] technology and [[Event Tracing for Windows (ETW)]] technology.

> It can retrieve logs from both local and remote computers.

---
### Using Get-WinEvent

To list the available logs, we can use the `-ListLog` flag.
```powershell
Get-WinEvent -ListLog *
```
- Specifying a `*` at the end retrieves all logs without any filtering applied.

To specify a set of columns to show, and format the output as a table, we can use the following:
```powershell
Get-WinEvent -ListLog * | Select-Object LogName, RecordCount, IsClassicLog, IsEnabled, LogMode, LogType | Format-Table -AutoSize
```

To specify the provider for the logs we can use the `-ListProvider` flag.
```powershell
Get-WinEvent -ListProvider * | Format-Table -AutoSize
```

To retrieve events from the System log:
```powershell
Get-WinEvent -LogName 'System' -MaxEvents 50 | Select-Object TimeCreated, ID, ProviderName, LevelDisplayName, Message | Format-Table -AutoSize
```

To retrieve events from **Microsoft-Windows-WinRM/Operational**:
```powershell
Get-WinEvent -LogName 'Microsoft-Windows-WinRM/Operational' -MaxEvents 30 | Select-Object TimeCreated, ID, ProviderName, LevelDisplayName, Message | Format-Table -AutoSize
```

> Can use the `-Oldest` flag to obtain the oldest events instead of manually sorting.

To retrieve events from a `.evtx` file, we need to specify the path:
```powershell
Get-WinEvent -Path 'C:\Tools\chainsaw\EVTX-ATTACK-SAMPLES\Execution\exec_sysmon_1_lolbin_pcalua.evtx' -MaxEvents 5 | Select-Object TimeCreated, ID, ProviderName, LevelDisplayName, Message | Format-Table -AutoSize
```

To filter windows events, the `-FilterHashtable` flag can be used to define conditions:
```powershell
Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational'; ID=1,3} | Select-Object TimeCreated, ID, ProviderName, LevelDisplayName, Message | Format-Table -AutoSize
```
- This obtains events with IDs 1 and 3.

To get logs based on certain dates, we can create date variables:
```powershell
$startDate = (Get-Date -Year 2023 -Month 5 -Day 28).Date
$endDate   = (Get-Date -Year 2023 -Month 6 -Day 3).Date

Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational'; ID=1,3; StartTime=$startDate; EndTime=$endDate} | Select-Object TimeCreated, ID, ProviderName, LevelDisplayName, Message | Format-Table -AutoSize
```

To filter logs using XML:
```powershell
Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational'; ID=3} |
`ForEach-Object {
$xml = [xml]$_.ToXml()
$eventData = $xml.Event.EventData.Data
New-Object PSObject -Property @{
    SourceIP = $eventData | Where-Object {$_.Name -eq "SourceIp"} | Select-Object -ExpandProperty '#text'
    DestinationIP = $eventData | Where-Object {$_.Name -eq "DestinationIp"} | Select-Object -ExpandProperty '#text'
    ProcessGuid = $eventData | Where-Object {$_.Name -eq "ProcessGuid"} | Select-Object -ExpandProperty '#text'
    ProcessId = $eventData | Where-Object {$_.Name -eq "ProcessId"} | Select-Object -ExpandProperty '#text'
}
}  | Where-Object {$_.DestinationIP -eq "52.113.194.132"}
```
- The Windows XML EventLog (EVTX) format can be foundÂ [here](https://github.com/libyal/libevtx/blob/main/documentation/Windows%20XML%20Event%20Log%20(EVTX).asciidoc).

