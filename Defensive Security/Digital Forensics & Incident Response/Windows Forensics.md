Check out [[Windows Registry Forensics]] for more details. 
### [[File System#NTFS|NTFS]]

Windows systems now all use the new file system, NTFS or *New Technology File System*, and the following are some key forensic artifacts that can be analyzed for this file system.
- *File Metadata*: NTFS stores extensive metadata for each file, including creation time, modification time, access time, and attribute information (such as read-only, hidden, or system file attributes). Analyzing these timestamps can help establish timelines and reconstruct user activities. Can check out the `$LOGFILE` which is the journal for the filesystem with some metadata.
- *MFT Entries*: The [[File System#MFT - Master File Table|Master File Table]] (MFT) is a crucial component of NTFS that stores metadata for all files and directories on a volume. Examining MFT entries provides insights into file names, sizes, timestamps, and data storage locations. When files are deleted, their MFT entries are marked as available, but the data may remain on the disk until overwritten. Use the tool *MFT Explorer* by Eric Zimmerman.
- *File Slack and Unallocated Space*: Unallocated space on an NTFS volume may contain remnants of deleted files or fragments of data. **File slack** refers to the unused portion of a cluster that may contain data from a previous file. Digital forensic tools can help recover and analyze data from these areas.
- *File Signatures*: File headers and signatures can be useful in identifying file types even when file extensions have been changed or obscured. This information is critical for reconstructing the types of files present on a system.
- *USN Journal*: The [[File System#Update Sequence Number|Update Sequence Number]] (USN) Journal is a log maintained by NTFS to record changes made to files and directories. Forensic investigators can analyze the USN Journal to track file modifications, deletions, and renames. Also known as the change journal, it resides in the `\$Extend` directory as the `\$UsnJrnl` file, with its actual records stored in the `\$UsnJrnl:$J` data stream.
- *LNK Files*: Windows shortcut files (LNK files) contain information about the target file or program, as well as timestamps and metadata. These files can provide insights into recently accessed files or executed programs.
- *Internet Explorer/Edge History*: This includes files opened on the system, regardless if they were opened using the browser or not. Contains the time of access, as well as the program used to access. This history is present at `C:\Users\<username>\AppData\Local\Microsoft\Windows\Webcache\WebCacheV*.dat`. *Autopsy* can be used to analyze this file by choosing *logical files* as the data source and choosing *Recent Activity* in the ingest modules. Any files or folders accessed appear with `file:///*` prefix in the *Web History* option on the left panel under *Data Artifacts*
- *Prefetch Files*: Prefetch files are generated by Windows to improve the startup performance of applications. These files can indicate which programs have been run on the system and when they were last executed.
- *[[Windows Registry]] Hives*: While not directly related to the file system, Windows Registry hives contain important configuration and system information. Malicious activities or unauthorized changes can leave traces in the registry, which forensic investigators analyze to understand system modifications.
- *Shellbags*: Shellbags are registry entries that store folder view settings, such as window positions and sorting preferences. Analyzing Shellbags can reveal user navigation patterns and potentially identify accessed folders. The *shellbag explorer tool* by Eric Zimmerman can be used to analyze shellbags.
- *Thumbnail Cache*: Thumbnail caches store miniature previews of images and documents. These caches can reveal files that were recently viewed, even if the original files have been deleted.
- *Recycle Bin*: The Recycle Bin contains files that have been deleted from the file  system. Analyzing the Recycle Bin can help recover deleted files and provide insights into user actions.
- *Alternate Data Streams (ADS)*: ADS are additional streams of data associated with files. Malicious actors may use ADS to hide data, and forensic investigators need to examine these streams to ensure a comprehensive analysis. The [[File System#Zone.Identifier|Zone.Identifier]] stream is an essential one to examine that contains information about the file if it was downloaded from the internet.
- *Volume Shadow Copies*: NTFS supports Volume Shadow Copies, which are snapshots of the file system at different points in time. These copies can be valuable for data recovery and analysis of changes made over time.
- *Security Descriptors and ACLs*: Access Control Lists (ACLs) and security descriptors determine file and folder permissions. Analyzing these artifacts helps understand user access rights and potential security breaches.
- *Shortcut Files*: Windows creates shortcut files for each file opened, and this shortcut contains information about the first and last open times of the file, the path of the file, and some other data. This data can be found at `C:\Users\<username>\AppData\Roaming\Microsoft\Windows\Recent\` or `C:\Users\<username>\AppData\Roaming\Microsoft\Office\Recent\`. Can use *LECmd* by [[Eric Zimmerman Tools]]. Can also be used to give information on connected USB devices.
- *USB/External Devices*: When devices are attached to the system, information related to that device is stored din `C:\Windows\inf\setupapi.dev.log`. Contains information about serial number, and the first/last times devices were connected.

---
### [[Windows Events Log]]

This is a part of the windows operating system and its stores logs from different components of the system.
- It logs application errors, security events, and diagnostic information.

Through the windows event logs, a good sense of what is happening can be obtained and searched through.
- The default file path for log storage is `C:\Windows\System32\winevt\logs`

> To analyze them with a tool like Timeline Explorer in CSV format, first need to use [[Eric Zimmerman Tools#EvtxECmd|EvtxECmd]] to convert it to CSV format with the needed columns.

---
### Execution Artifacts

This is the evidence left behind on a Windows system when programs and processes are executed, such as applications, scripts, or other software components.
- Through analysis of execution artifacts, timelines can be reconstructed of what happened, malicious activity can be identified, and patterns of behavior can be established.
- Check out [[Windows Registry Forensics#Execution Evidence - Windows Forensics Execution Artifacts Windows Execution Artifacts|Execution Evidence in the Registry]].

Some execution artifacts that should be analyzed:
- *Prefetch Files*: Windows maintains a prefetch folder that contains metadata about the execution of various applications. Prefetch files record information such as file paths, execution counts, other file and device handles used, and timestamps of when applications were run. Analyzing prefetch files can reveal a history of executed programs and the order in which they were run. This information is stored in `C:\Windows\Prefetch`. Can be analyzed using [[Eric Zimmerman Tools#PECmd - Prefetch Parser|PECmd]] and *Timeline Explorer* tools by Eric Zimmerman.
- *Windows 10 Timeline*: Windows 10 stores recently used apps and files in an SQLite database called `Windows 10 Timeline`. Contains information about last executed programs, especially the last executed app and the focus time. Can be found at `\Users\<username>\AppData\Local\ConnectedDevicesPlatform\<folder>\ActivitiesCache.db`, where `<folder>` is `L.username`, or a Microsoft ID, or an Azure Active Directory ID. Can be analyzed using the *WxTCmd* [[Eric Zimmerman Tools]].
- *Shimcache (AppCompatCache)*: Shimcache is a Windows mechanism that logs information about program execution to assist with compatibility and performance optimizations. It records details such as file paths, execution timestamps, and flags indicating whether a program was executed. *AppCompatCacheParser* by Eric Zimmerman allows us to analyze the Shimcache, and the output can be analyzed by *EZviewer*, [link](https://ericzimmerman.github.io/#!index.md). Shimcache can help investigators identify recently executed programs and their associated files. `Registry: HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache`
- *Amcache*: Amcache is a database introduced in Windows 8 that stores information about installed applications and executables. It includes details like file paths, sizes, digital signatures, and timestamps of when applications were last executed, first executed, time of deletion, and first installation. Analyzing the Amcache can provide insights into program execution history and identify potentially suspicious or unauthorized software. `C:\Windows\AppCompat\Programs\Amcache.hve`. Last executed programs can be found in the `\Root\File\{volume guid}`.
- *UserAssist*: UserAssist is a registry key that maintains information about programs executed by users. It records details such as application names, execution counts, and timestamps. *Does not contain programs run using the command line*. Analyzing UserAssist artifacts can reveal a history of executed applications and user activity. `Registry: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\UserAssist`
- *RunMRU Lists*: The RunMRU (Most Recently Used) lists in the [[Windows Registry]] store information about recently executed programs from various locations, such as the `Run` and `RunOnce` keys. These lists can indicate which programs were run, when they were executed, and potentially reveal user activity. `Registry: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU`
- *Jump Lists*: Jump Lists store information about recently accessed files, folders, and tasks associated with specific applications. They can provide insights into user activities and recently used files, including execution times. These can be seen by right clicking on an application in the task bar and seeing the recently opened files for that app. This data is also present at `C:\Users\<username>\AppData\Roaming\Microsoft\Windows\Recent\AutomaticDestinations`. Can use the *JLECmd* [[Eric Zimmerman Tools]].
- *Shortcut (LNK) Files*: Shortcut files can contain information about the target executable, file paths, timestamps, and user interactions. Analyzing LNK files can reveal details about executed programs and the context in which they were run. `Various locations (e.g., Desktop, Start Menu)`
- *Recent Items*: The Recent Items folder maintains a list of recently opened files. It can provide information about recently accessed documents and user activity. `User-specific folders (e.g., %AppData%\Microsoft\Windows\Recent)`
- *BAM/DAM*: The background activity monitor and desktop activity monitor store information about program runs and they contain the full path to the executables. Can be analyzed using [[RegRipper]] or *Registry Explorer* by Eric Zimmerman. They are found at `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\bam\UserSettings\{SID}` and `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\dam\UserSettings\{SID}`
- *Windows Event Logs*: Various Windows event logs, such as the Security, Application, and System logs, record events related to program execution, including process creation and termination, application crashes, and more. `C:\Windows\System32\winevt\Logs`

---
### Persistence Artifacts

Persistence refers to the techniques and mechanisms used by attackers to maintain their unauthorized presence in a system after the initial intrusion.
- They exploit *registry keys, startup processes, scheduled tasks, and services* to withstand system reboots and security measures.

Some *Autorun* keys that are used for persistence:
1. **`Run/RunOnce Keys`**
- `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`
- `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce`
- `HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run`
- `HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce`
- `HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\`
2. **`Keys used by WinLogon Process`**
- `HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon`
- `HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Shell`
3. **`Startup Keys`**
- `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders`
- `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders`
- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders`
- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User`

Another technique for persistence is by using *scheduled tasks*, also called *Schtasks*.
- These are tasks that reside in `C:\Windows\System32\Tasks`, and each task is saved as an [[XML]] file.
- The [[XML]] file stores the creator, the task timing, the task trigger, and the path to the program to execute.

Another technique for persistence is by using *Services* which are used to enable software components to operate in the background without any user intervention.
- Malicious users can craft services to ensure persistence.
- The registry can show these services at `HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services`.
- If the `start` key is set to `0x02`, then this service will start at boot.

---
### [[System Resource Usage Monitor (SRUM)]]

Can be used to monitor resource utilization and application usage patterns. It provides the following functionalities:
- *Application Profiling*: SRUM can provide a comprehensive view of the applications and processes that have been executed on a Windows system. It records details such as *executable names, file paths, timestamps, and resource usage metrics*. This information is crucial for understanding the software landscape on a system, identifying potentially malicious or unauthorized applications, and reconstructing user activities.
- *Resource Consumption*: SRUM captures data on *CPU time, network usage, and memory consumption* for each application and process. This data is invaluable for investigating resource-intensive activities, identifying unusual patterns of resource consumption, and detecting potential performance issues caused by specific applications.
- *Timeline Reconstruction*: By analyzing SRUM data, digital forensics experts can create timelines of application and process execution, resource usage, and system activities. This timeline reconstruction is instrumental in understanding the sequence of events, identifying suspicious behaviors, and establishing a clear picture of user interactions and actions.
- *User and System Context*: SRUM data includes *user identifiers*, which helps in attributing activities to specific users. This can aid in user behavior analysis and determining whether certain actions were performed by legitimate users or potential threat actors.
- *Malware Analysis and Detection*: SRUM data can be used to identify unusual or unauthorized applications that may be indicative of malware or malicious activities. Sudden spikes in resource usage, abnormal application patterns, or unauthorized software installations can all be detected through SRUM analysis.
- [[Incident Handling|Incident Response]]: During incident response, SRUM can provide rapid insights into recent application and process activities, enabling analysts to quickly identify potential threats and respond effectively.

---
### PowerShell Investigation

- `Unusual Commands`: Look for PowerShell commands that are not typical in your environment or are commonly associated with malicious activities. For example, commands to download files from the internet (`Invoke-WebRequest` or `wget`), commands that manipulate the registry, or those that involve creating scheduled tasks.
- `Script Execution`: Check for the execution of PowerShell scripts, especially if they are not signed or come from untrusted sources. Scripts can be used to automate malicious actions.
- `Encoded Commands`: Malicious actors often use encoded or obfuscated PowerShell commands to evade detection. Look for signs of encoded commands in transcripts.
- `Privilege Escalation`: Commands that attempt to escalate privileges, change user permissions, or perform actions typically restricted to administrators can be suspicious.
- `File Operations`: Check for PowerShell commands that involve creating, moving, or deleting files, especially in sensitive system locations.
- `Network Activity`: Look for commands related to network activity, such as making [[HTTP]] requests or initiating network connections. These may be indicative of command and control (C2) communications.
- `Registry Manipulation`: Check for commands that involve modifying the [[Windows Registry]], as this can be a common tactic for malware persistence.
- `Use of Uncommon Modules`: If a PowerShell script or command uses uncommon or non-standard modules, it could be a sign of suspicious activity.
- `User Account Activity`: Look for changes to user accounts, including creation, modification, or deletion. Malicious actors may attempt to create or manipulate user accounts for persistence.
- `Scheduled Tasks`: Investigate the creation or modification of scheduled tasks through PowerShell. This can be a common method for persistence.
- `Repeated or Unusual Patterns`: Analyze the patterns of PowerShell commands. Repeated, identical commands or unusual sequences of commands may indicate automation or malicious behavior.
- `Execution of Unsigned Scripts`: The execution of unsigned scripts can be a sign of suspicious activity, especially if script execution policies are set to restrict this.

---
